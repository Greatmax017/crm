/**
 * Created by Think on 2017/7/12.
 */
var app = angular.module('children', ['ngFileUpload']);
app.controller('aboutusController', ['$scope', '$timeout', '$location', '$state', function ($scope, $timeout, $location, $state) {
    // $location.hash("top");
    $scope.contact = { 'Name': '', 'Email': '', 'Phone': '', 'Content': '' };
    //提交预约信息
    $scope.contactpost = function () {
        if (!$('#forms').valid()) {
            return false;
        }

        $scope.matrixPost(true, "/Contact/Contact", $scope.contact, function (res) {
            if (res.Success == true) {
                // console.log();

                alert($scope.message[$scope.Language].success);
                $state.go('aboutus');
                // $scope.contact = {'Name':'','Email':'','Phone':'','Content':''};
            } else {
                alert(res.Message);
            }
        })
    }
}]);
app.directive('valid', function () {
    return {
        restrict: "AE",
        link: function (scope, element, attrs) {
            // console.log($('#form'))
            var self = $(element).attr('id');
            $('#' + self).validate();
            // console.log(self);
        }
    }
});

app.directive('slideGo', function () {
    return {
        restrict: "AE",
        link: function (scope, element, attrs) {
            jQuery(document).ready(function ($) {
                var jssor_1_SlideshowTransitions = [
                    {$Duration:1200,x:0.3,$During:{$Left:[0.3,0.7]},$Easing:{$Left:$Jease$.$InCubic,$Opacity:$Jease$.$Linear},$Opacity:2},
                    {$Duration:1200,x:-0.3,$SlideOut:true,$Easing:{$Left:$Jease$.$InCubic,$Opacity:$Jease$.$Linear},$Opacity:2},
                    {$Duration:1200,x:-0.3,$During:{$Left:[0.3,0.7]},$Easing:{$Left:$Jease$.$InCubic,$Opacity:$Jease$.$Linear},$Opacity:2},
                    {$Duration:1200,x:0.3,$SlideOut:true,$Easing:{$Left:$Jease$.$InCubic,$Opacity:$Jease$.$Linear},$Opacity:2}
                ];

                var jssor_1_options = {
                    $AutoPlay: true,
                    $SlideshowOptions: {
                        $Class: $JssorSlideshowRunner$,
                        $Transitions: jssor_1_SlideshowTransitions,
                        $TransitionsOrder: 1
                    },
                    $ArrowNavigatorOptions: {
                        $Class: $JssorArrowNavigator$
                    },
                    $ThumbnailNavigatorOptions: {
                        $Class: $JssorThumbnailNavigator$,
                        $Cols: 10,
                        $SpacingX: 8,
                        $SpacingY: 8,
                        $Align: 360
                    }
                };

                var jssor_1_slider = new $JssorSlider$("jssor_1", jssor_1_options);
// console.log($(window).width());
                //responsive code begin
                //you can remove responsive code if you don't want the slider scales while window resizing
                function ScaleSlider() {
                    var refSize = jssor_1_slider.$Elmt.parentNode.clientWidth;
                    if (refSize) {
                        var scremwidth = $(window).width();
                        // scremwidth = scremwidth>1920?1920:scremwidth;
                        refSize = Math.min(refSize, scremwidth);
                        jssor_1_slider.$ScaleWidth(refSize);
                        // jssor_1_slider.$ScaleHeight(800);
                    }
                    else {
                        window.setTimeout(ScaleSlider, 30);
                    }

                }
                ScaleSlider();
                $(window).bind("load", ScaleSlider);
                $(window).bind("resize", ScaleSlider);
                $(window).bind("orientationchange", ScaleSlider);
                //responsive code end
            });
        }
    }
});

// 指令加载啊aaaa地图高德地图api.
app.directive('map', ['$compile', '$timeout', function ($compile, $timeout) {
    return {
        restrict: "AE",
        link: function (scope, element, attrs) {
            // console.log(AMap);

            // require(['BMap'], function (BMap) {
            // console.log(BMap);
            $timeout(function () {
                var map = new BMap.Map("allmap");
                // console.log(BMap);
                var point = new BMap.Point(151.2051867, -33.8632473);
                map.centerAndZoom(point, 12);
                var mk = new BMap.Marker(point);
                map.addOverlay(mk);
                map.panTo(point);
                map.enableScrollWheelZoom(true);
                //     var map = new AMap.Map('allmap',{
                //         resizeEnable: true,
                //         zoom: 10,
                //         center: [151.2051867,-33.8632473]
                //     });
                //     var marker = new AMap.Marker({
                //         position: map.getCenter(),
                //         draggable: true,
                //         cursor: 'move'
                //     });
                //     marker.setMap(map);
                //     // 设置点标记的动画效果，此处为弹跳效果
                //     marker.setAnimation('AMAP_ANIMATION_BOUNCE');
                //     //中英文版地图
                //     if(scope.Language == 'en'){
                //         map.setLang('en');
                //     }else{
                //         map.setLang('zh_cn');
                //     }
                // },500)
            }, 500)
            // })
        }
    }
}])
myApp.controller('loginController', ['$scope', '$http', '$location', '$timeout', '$state', function ($scope, $http, $location, $timeout, $state) {
    $('body').addClass('bg-black');
    // $scope.clearSession();
    // $scope.user.isLogin = false;
    // sessionStorage.removeItem('user');
    // sessionStorage.removeItem('token');
    // sessionStorage.removeItem('isLogin');
    // $scope.userInfo = '';
    $scope.login = function () {
        $("#hide").show();
        var params = {
            "email": $scope.Username,
            "pwd": $scope.Password
        }
        $scope.matrixPost(true, "/WebLogin/Login", params, function (res) {
            if (res.Success) {
                $scope.userInfo = res.Data.loginUser;
                $scope.user.isLogin = true;
                // console.log($scope.user);
                $scope.user = res.Data.loginUser;
                sessionStorage.setItem('user', $scope.user);
                sessionStorage.setItem('token', res.Data.token);
                sessionStorage.setItem('isLogin', true);
                // console.log($scope.userInfo);
                if ($scope.Language == 'en') {
                    alert('Login Success', 'login');
                } else {
                    alert('登录成功', 'login');
                }
                $timeout(function () {
                    $state.go("center");
                    $("#hide").hide();
                    $('body').removeClass('bg-black');
                }, 800);
            }
            else {
                alert(res.Message);
                $("#hide").hide();
            }
        })
    }
}]);
myApp.controller('membertypeController', ['$scope', '$location', function ($scope, $location) {
    $('body').removeClass('bg-black');
    //推广链接注册
    $scope.code = $location.search()["code"];
    $scope.guide = false;
    //个人客户注册
    $scope.personRegistered = function () {
        // console.log($scope.guide);
        $location.path("PersonRegister").search({ 'code': $scope.code });
    }
    //机构客户注册
    $scope.mechanismRegistered = function () {
        $location.path("CompanyRegister").search({ 'code': $scope.code });
    }
}]);
myApp.controller('AccountInfoController', ['$scope', 'PagesService', function ($scope, PagesService) {
    $scope.childtype = 'invest';
    // console.log($scope.MtInfo);
    $scope.AccountInfo = '';//仪表盘信息
    $scope.NowPos = '';//当前你持仓数据
    //盈利报告数据
    $scope.repotdata = { 'data': '', 'starttime': new Date('2017-2-9'), 'endtime': new Date(PagesService.getCurrentTime()), 'type': '0', 'error': '' };
    // var status = $scope.GetInfo();
    // return status;
    //获取当前持仓
    $scope.GetNowPos = function () {
        $scope.loading_min = true;
        $scope.NowPos = '';
        // console.log('获取当前持仓数据...');
        $scope.matrixPost(false, "/MyInfo/GetCurrentPositions", {}, function (res) {
            if (res.Success) {
                $scope.NowPos = res.Data;
                // console.log($scope.NowPos);
                $scope.loading_min = false;
                // $scope.ApplyData.realname = res.Data.RealName;
            } else if (res.IsLogin == false) {
                // alert($scope.message[$scope.Language].loginOut);
                $scope.clearSession();
                $scope.loading_min = false;
            } else {
                $scope.loading_min = false;
                alert(res.Message);
            }
        })
    }
    //获取仪表盘信息
    $scope.GetAccountInfo = function () {
        // console.log('获取仪表盘信息...');
        function gets() {
            $scope.AccountStatus();
            $scope.matrixPost(false, "/MyInfo/GetAccountDashBoard", {}, function (res) {
                if (res.Success) {
                    $scope.AccountInfo = res.Data;
                    // console.log($scope.AccountInfo);
                    // $scope.ApplyData.realname = res.Data.RealName;
                } else if (res.IsLogin == false) {
                    // alert($scope.message[$scope.Language].loginOut);
                    $scope.clearSession();
                } else {
                    alert(res.Message);
                }
            })
            $scope.GetNowPos();
        }
        $scope.matrixPost(false, "/MyInfo/GetInfo", {}, function (res) {
            $scope.Nomt4 = 'havamt4';
            if (res.Success && !res.Data.IsChecke) {
                $scope.Nomt4 = 'nomts';
                alert($scope.Language != 'en' ? 'MT4账户审核中,没有账户信息概括' : 'MT4 Account is under review');
                return false;
            } else if (res.Success && res.Data.IsChecke) {
                gets();
                return true;
            } else {
                alert(res.Message);
                return false;
            }
        })
    };
    $scope.GetAccountInfo();
    //历史持仓
    $scope.HistryPos = function () {
        $scope.NowPos = '';
        // console.log('获取历史持仓数据...');
        $scope.AccountStatus();
        $scope.matrixPost(false, "/MyInfo/GetHistoryPositions", {}, function (res) {
            if (res.Success) {
                $scope.NowPos = res.Data;
                // console.log($scope.NowPos);
                // $scope.ApplyData.realname = res.Data.RealName;
            } else if (res.IsLogin == false) {
                // alert($scope.message[$scope.Language].loginOut);
                $scope.clearSession();
            } else {
                alert(res.Message);
            }
        })
    }
    //盈利报告
    $scope.getHistroy = function () {
        $scope.AccountStatus();
        var data = {
            'start': $scope.repotdata.starttime,
            'end': $scope.repotdata.endtime,
            'sstats': parseInt($scope.repotdata.type)
        }
        $scope.matrixPost(false, "/WebTrade/GetProfitReport", data, function (res) {
            if (res.Success) {
                $scope.repotdata.data = res.Data;
                // $scope.orderdata.page = PagesService.pages(res.Data.TotalCount,data.pageSize,data.pageIndex);
            } else if (res.IsLogin == false) {
                $scope.clearSession();
            } else {
                alert(res.Message);
            }
        });
    }
    $scope.Switchs = function (type) {
        function childty() {
            $scope.childtype = type;
            if (type == 'invest') {
                //当前持仓
                // console.log('当前持仓');
                $scope.GetNowPos();
            } else if (type == 'histryOrder') {
                //历史订单
                // console.log('历史订单');
                $scope.HistryPos();
            } else {
                $scope.getHistroy();
            }
        }
        // var statsu = $scope.GetInfo($scope.Language!='en'?'MT4账户审核中':'MT4 Account is under review');
        // return statsu;
        $scope.matrixPost(false, "/MyInfo/GetInfo", {}, function (res) {
            if (res.Success && !res.Data.IsChecke) {
                $scope.Nomt4 = 'nomts';
                alert($scope.Language != 'en' ? 'MT4账户审核中,不能获取该信息' : 'MT4 Account is under review');
                return false;
            } else if (res.Success && res.Data.IsChecke) {
                $scope.Nomt4 = 'havamt4';
                childty();
                return true;
            } else {
                $scope.Nomt4 = 'nomts';
                alert(res.Message);
                return false;
            }
        })
    };
}]);
myApp.controller('AccountSetController', ['$scope', '$http', '$location', '$timeout', function ($scope, $http, $location, $timeout) {
    // console.log('修改密码...');
    $scope.changType = 'login';
    $scope.password = { 'OldPassword': '', 'NewPassword': '', 'SurePassword': '' };
    $scope.mtpassword = { 'OldPassword': '', 'NewPassword': '', 'SurePassword': '', 'type': "0" };
    $scope.change = function (valid) {
        if (!$('#form').valid()) {
            return false;
        }
        // console.log($('#form').validate());
        // if($('.form')){
        //
        // }
        // if(!valid){
        // 	alert($scope.message[$scope.Language].vaild);
        // 	return false;
        // }
        $scope.NewPassword = $scope.password.NewPassword.replace(/\s+/g, '');
        var params = {
            "lodpwd": $scope.password.OldPassword,
            "newpwd": $scope.password.NewPassword
        }
        $scope.matrixPost(true, "/MyInfo/ChangePwd", params, function (res) {
            if (res.Success) {
                // alert('修改成功，请重新登录!');
                alert($scope.message[$scope.Language].success);
                $timeout(function () {
                    $location.path('/login');//重新登录
                    $scope.clearSession(); //清除session
                }, 800);
                // $scope.password=$scope.NewPassword
            } else if (res.IsLogin == false) {
                $scope.clearSession();
            } else {
                alert(res.Message);
            }
        })
    }
    //修改mt4密码
    $scope.mtchange = function (valid) {
        $scope.AccountStatus();
        if (!$('#form').valid()) {
            return false;
        }
        // console.log($('#form').validate());
        // if($('.form')){
        //
        // }
        // if(!valid){
        // 	alert($scope.message[$scope.Language].vaild);
        // 	return false;
        // }
        $scope.NewPassword = $scope.password.NewPassword.replace(/\s+/g, '');
        var params = {
            "oldPwd": $scope.mtpassword.OldPassword,
            "newPwd": $scope.mtpassword.NewPassword,
            "type": parseInt($scope.mtpassword.type)
        }
        $scope.matrixPost(true, "/MyInfo/ChangeMT4Pwd", params, function (res) {
            if (res.Success) {
                alert($scope.message[$scope.Language].success);
            } else if (res.IsLogin == false) {
                $scope.clearSession();
            } else {
                alert(res.Message);
            }
        })
    }
    //重设mt4密码
    $scope.ResetMT4PWD = function (valid) {
        $scope.AccountStatus();
        
        $scope.matrixPost(true, "/MyInfo/RestMT4Pwd", {}, function (res) {
            if (res.Success) {
                alert($scope.message[$scope.Language].success);
            } else if (res.IsLogin == false) {
                $scope.clearSession();
            } else {
                alert(res.Message);
            }
        })
    }
    $scope.switchs = function (type) {
        if (type == 'mt4') {
            $scope.matrixPost(false, "/MyInfo/GetInfo", {}, function (res) {
                if (res.Success && !res.Data.IsChecke) {
                    $scope.Nomt4 = 'nomts';
                    alert($scope.Language != 'en' ? 'MT4账户审核中,不能修改MT4密码' : 'MT4 Account is under review');
                    return false;
                } else if (res.Success && res.Data.IsChecke) {
                    $scope.Nomt4 = 'havamt4';
                    $scope.changType = type;
                    return true;
                } else {
                    $scope.Nomt4 = 'nomts';
                    alert(res.Message);
                    return false;
                }
            });
        } else {
            $scope.changType = type;
        }
    }
}]);
myApp.directive('valid', function () {
    return {
        restrict: "AE",
        link: function (scope, element, attrs) {
            // console.log($('#form'))
            var self = $(element).attr('id');
            $('#' + self).validate();
            // console.log(self);
        }
    }
})
myApp.controller('CenterController', ['$scope', 'Upload', '$location', '$timeout','$http', function ($scope, Upload, $location, $timeout,$http) {
    // console.log('fiun');
    // $scope.MtInfo='';
    $('body').removeClass('bg-black');
    $scope.judgeLogin();
    $scope.times = new Date().getTime();
    $scope.symbols = [];
    $scope.GetAccountInfo = function () {
        $scope.matrixPost(true, "/MyInfo/GetCurrentAccountInfo", {}, function (res) {
            if (res.Success) {
                $scope.MtInfo = res.Data.Data;
                $scope.Agree = res.Data.Data.AutoTrade;
                // console.log($scope.MtInfo);
                // $scope.ApplyData.realname = res.Data.RealName;
            } else if (res.IsLogin == false) {
                // alert($scope.message[$scope.Language].loginOut);
                $scope.clearSession();
            } else {
                alert(res.Message);
            }
        })
    };
    $scope.GetAccountInfo();
    $scope.KycIsCheck = false;
    $scope.GetInfo = function (message) {
        $scope.Nomt4 = 'havamt4';
        $scope.matrixPost(false, "/MyInfo/GetInfo", {}, function (res) {
            if (res.Success && !res.Data.IsChecke) {
                $scope.Nomt4 = 'nomts';
                // alert(message);
                return false;
            } else if (res.Success && res.Data.IsChecke) {
                $scope.CurrencyType = res.Data.CurrencyType ? res.Data.CurrencyType : 'USD';
                if (res.Data.KycIsCheck) {
                    $scope.KycIsCheck = true;
                }
                return true;
            } else {
                alert(res.Message);
                return false;
            }
        })
    }
    $scope.GetInfo();
    $scope.nomt4 = function () {
        alert($scope.Language != 'en' ? 'MT4账户审核中,不能进行出入金操作' : 'MT4 Account is under review');
    }
    $scope.AccountStatus = function () {
        $scope.matrixPost(false, "/MyInfo/GetAccountStatus", {}, function (res) {
            if (res.Success) {
                return true;
            } else {
                $scope.clearSession();
                alert(res.Message);
                return false;
            }
        })
    };
    $scope.commondialogOption = {
        'uploadImgNocrop': function (config, Path, file) {
            $scope.loading = true;
            // console.log($scope.loading);
            // require(['upload','uploadshim'],function() {
            //     myApp.useModule("ngFileUpload");
            //     var Upload=myApp.get('Upload');
            var url = $scope.SimpleUrl + '/IBWebApi/MyInfo/UploadHeadImage';
            // return false;
            Upload.upload({
                //服务端接收
                url: url,
                file: file,
                headers: {
                    'Content-Language': $scope.Language,
                    'Authorization': sessionStorage.getItem('token')
                }
            }).progress(function (evt) {
                //进度条
                var progressPercentage = parseInt(100.0 * evt.loaded / evt.total);
            }).success(function (callbackData) {
                $scope.loading = false;
                if (callbackData.Success) {
                    $scope.MtInfo.HeadImage = callbackData.Data;
                    // // 为card赋值,注册时使用
                    // $scope.registerform[config.card] = callbackData.Data;
                    alert($scope.message[$scope.Language].success);
                    $(config.triggerCls).hide();
                    $(config.fileClass).val("");
                    // $(config.shows).attr('src','http://192.168.3.200:8012/'+callbackData.Data)
                    // $scope.getimglist();
                } else if (!callbackData.IsLogin) {
                    $scope.clearSession();
                } else {
                    alert(callbackData.Message);
                }
            }).error(function (data, status, headers, config) {
                alert($scope.message[$scope.Language].getError);
                $scope.loading = false;
            });
            // });
        }
    }
    $scope.changeFU = function(){
        $scope.Loading = true;
        var url = '/MyInfo/UpLoadAttachment';
        var file =  $('#Enclosurefiles')[0].files[0];
        console.log(file);
        var fd = new FormData();
        fd.append('file', file);
        fd.append('name', $('#describe').val());
        $http.post($scope.SimpleUrl+url,fd,{
            transformRequest: angular.identity,
            headers: {
                'Content-Type': undefined,
                'Authorization': sessionStorage.getItem('token')
                // 'Content-Language': $scope.Language
            }
        }).success(function (res) {
        //    alert('sucess');
            if (res.Success) {
                // $scope.attrment.push('/File/Attachment/2017-10-20/8f2867c1-871e-47fa-ab62-400e9ff6c3a1.jpg');
                $('#Enclosurefiles').val("");
                alert('sucecss');
                $scope.getaAttrment();
            } else if (res.IsLogin == false) {
                $scope.clearSession();
            } else {
                alert(res.Message);
            }
            $scope.Loading = false;
        }).error(function (e) {
            alert('error');
            $scope.Loading = false;
        });
    };
    $scope.getaAttrment = function(){
        var url = '/MyInfo/GetAttachmentList';
        $scope.matrixPost(true, url, {}, function (res) {
            if (res.Success) {
                $scope.attrment = res.Data;
            } else if (res.IsLogin == false) {
                $scope.clearSession();
            } else {
                // alert(res.Message);
            }
        })
    }
    $scope.showImg = function(url){
        $('#Bigimg').fadeIn(200);
        $('#Bigimg').find('.myImg').attr('src',$scope.SimpleUrl+url);
        $('#Bigimg').click(function(){
            $('#Bigimg').fadeOut(200);
        })
    }   
}]);
myApp.controller('KycController', ['$scope', 'Upload', 'fieldService', '$timeout', function ($scope, Upload, fieldService, $timeout) {

    $scope.changes = {
        'gupiao': { 'value': '', 'type': '' },
        'foreign': { 'value': '', 'type': '' },
        'futures': { 'value': '', 'type': '' },
        'option': { 'value': '', 'type': '' },
        'contract': { 'value': '', 'type': '' },
        'fund': { 'value': '', 'type': '' },
        'dynamicProperties': ''
    };
    $scope.tile = 'profile';
    $scope.expri = '';
    $scope.KycIsCheck = false;
    var alldata = {};
    $scope.judgeLogin();
    //自定义字段
    $scope.changeforms = [];//动态字段表单
    $scope.formIdss = fieldService.formIds;//表单Id
    fieldService.getFields([$scope.formIdss.PersonalInformation, $scope.formIdss.CompanyInformation], $scope.changeforms);//获取动态字段
    $scope.user = function () {
        $scope.AccountStatus();
        //获取动态表单信息
        // $scope.getFields([2, 4], $scope.changeforms);
        $scope.matrixPost(true, "/MyInfo/GetInfo", {}, function (res) {
            if (res.Success) {
                if( res.Data.DateOfBirth){
                    res.Data.DateOfBirth = new Date(res.Data.DateOfBirth.split('T')[0]);
                }
                $scope.resInfo = res.Data;

                if (res.Data.KycIsCheck) {
                    $scope.KycIsCheck = true;
                }

                $timeout(function () {
                    $scope.expri = JSON.parse($scope.resInfo.TradingExperience)

                    $scope.changes.dynamicProperties = JSON.parse($scope.resInfo.DynamicProperties);
                    var datadiy = angular.copy($scope.changes.dynamicProperties);
                    // $scope.changes.dynamicProperties={};
                    for (var key in datadiy) {
                        var ids = { 'FormId': 2, 'FieldId': key };
                        fieldService.getDynamicPropertiesValue($scope.changes.dynamicProperties, ids);
                        // var keys = 'f2-'+key;
                        // $scope.changes.dynamicProperties[keys] = datadiy[key];
                    }
                }, 100)
                
            } else if (res.IsLogin == false) {
                $scope.clearSession();
            } else {
                alert(res.Message);
            }
        })
    }
    $scope.user();
    $scope.ChangeInfo = function () {
        console.log($scope.changes);
        var data = {
            "Id": $scope.resInfo.Id,
            "Email": $scope.resInfo.Email,
            // "Pwd": alldata.password,
            // "Country": $scope.country,
            "PhoneNumber": $scope.resInfo.PhoneNumber,
            "AgentCode": $scope.resInfo.AgentCode,
            "Address": $scope.resInfo.Address,
            "AddressPhoto": $scope.resInfo.AddressPhoto,
            "DateOfBirth": $scope.resInfo.DateOfBirth,
            "Language": $scope.Language,
            "RealName": $scope.resInfo.RealName,
            // "QQ": $scope.qq,
            "Gender": $scope.resInfo.Gender,
            'Age': $scope.resInfo.Age,
            "CertificateCardType": $scope.resInfo.CertificateCardType,
            "CertificateCardNumber": $scope.resInfo.CertificateCardNumber,
            "AnnualIncome": $scope.resInfo.AnnualIncome,
            "TotalAssets": $scope.resInfo.TotalAssets,
            "CardNumber1": $scope.resInfo.CardNumber1,
            "CardNumber2": $scope.resInfo.CardNumber2,
            "TradingExperience": JSON.stringify($scope.expri),
            "BankHeadOffice": $scope.resInfo.BankHeadOffice,
            "BranchOfficeOfBankAccount": $scope.resInfo.BranchOfficeOfBankAccount,
            "BankNumber": $scope.resInfo.BankNumber,
            "BankPhoto": $scope.resInfo.BankPhoto,
            "Type": 0,//0个人注册
            'DynamicProperties': JSON.stringify($scope.changes.dynamicProperties, undefined, 2)
        }
        $scope.matrixPost(true, "/MyInfo/ChangeInfo", data, function (res) {
            if (res.Success == true) {
                alert($scope.message[$scope.Language].success);
                $scope.user();
            } else if (res.IsLogin == false) {
                $scope.clearSession();
            } else {
                alert(res.Message);
            }
        })
    }
    $scope.commondialogOption = {
        'uploadImgNocrop': function (config, Path, file) {
            $scope.loading = true;
            // console.log($scope.loading);
            // require(['upload', 'uploadshim'], function () {
            //     myApp.useModule("ngFileUpload");
            //     var Upload = myApp.get('Upload');
            var url = $scope.SimpleUrl + '/IBWebApi/WebLogin/UpLoadImage';
            // console.log(config);
            // return false;
            Upload.upload({
                //服务端接收
                url: url,
                file: file,
                headers: {
                    'Content-Language': $scope.Language
                }
            }).progress(function (evt) {
                //进度条
                var progressPercentage = parseInt(100.0 * evt.loaded / evt.total);
            }).success(function (callbackData) {
                // console.log(callbackData);
                $scope.loading = false;
                // $('#forms').valid();
                if (callbackData.Success) {
                    // if (location.href.indexOf('CompanyRegister') > 0) {
                    // 为card赋值,注册时使用
                    // $scope.registercomp[config.card] = callbackData.Data;
                    // } else {
                    $scope.resInfo[config.card] = callbackData.Data;
                    // }
                    // // 为card赋值,注册时使用
                    // $scope.registerform[config.card] = callbackData.Data;
                    alert($scope.message[$scope.Language].success);
                    $(config.triggerCls).hide();
                    // $(config.shows).attr('src','http://192.168.3.200:8012/'+callbackData.Data)
                    // $scope.getimglist();
                } else {
                    alert(callbackData.Message);
                }
            }).error(function (data, status, headers, config) {
                console.log(error);
                alert($scope.message[$scope.Language].getError);
                $scope.loading = false;
            });
            // });
        }
    }
    $scope.getaAttrment();
    // console.log('fiun');
    // $scope.MtInfo='';
    // $scope.times= new Date().getTime();
    // $scope.GetAccountInfo = function(){
    // 	$scope.matrixPost(true, "/MyInfo/GetCurrentAccountInfo", {}, function (res) {
    // 		if (res.Success == true) {
    // 			$scope.MtInfo = res.Data;
    // 			console.log($scope.MtInfo);
    // 			// $scope.ApplyData.realname = res.Data.RealName;
    // 		}else if(res.IsLogin==false){
    // 			// alert($scope.message[$scope.Language].loginOut);
    // 			$scope.clearSession();
    // 		}else{
    // 			alert(res.Message);
    // 		}
    // 	})
    // };
    // $scope.GetAccountInfo();
}]);
//账户管理
myApp.controller('ManagementController', ['$scope', function ($scope) {
    // $scope.type='deposit';
    $scope.times = new Date().getTime();
    // return false;
    // //判断是否登录
    // $scope.user= function () {
    //     console.log('登录');
    //     // return false;
    //     $scope.matrixPost(true, "/MyInfo/GetInfo", {}, function (res) {
    //         if (res.Success) {
    //             $scope.ApplyData.realname = res.Data.RealName;
    //         }else if(res.IsLogin==false){
    //             // alert($scope.message[$scope.Language].loginOut);
    //             $scope.clearSession();
    //         }else{
    //             alert(res.Message);
    //         }
    //     })
    // };
    //
    // $scope.user();
}]);
myApp.controller('applyController', ['$scope', '$location', '$timeout', '$http', function ($scope, $location, $timeout, $http) {
    // $scope.type='ApplyWithdrawals';
    // console.log('apply');
    $scope.ApplyData = { 'realname': '', 'USDmoney': '', 'CNYmoney': '', 'bankHeadOffice': '', 'bankNumber': '', 'accountName': '', 'Rate': '' };
    //获取用户信息.
    $scope.getRates('ispost',$scope.ApplyData);
    $scope.user = function () {
        $scope.AccountStatus();
        $scope.matrixPost(true, "/MyInfo/GetInfo", {}, function (res) {
            if (res.Success && !res.Data.IsChecke) {
                // $timeout(function(){
                //     $location.path('/center/AccountInfo');
                // },300);
                $scope.Nomt4 = 'nomts';
                // alert($scope.Language!='en'?'MT4账户审核中，不能进行银行入金':'MT4 Account is under review,Can not be out of gold management');
            } else if (res.Success) {
                $scope.Nomt4 = 'havamt4';
                $scope.ApplyData.realname = res.Data.RealName;
            } else if (res.IsLogin == false) {
                $scope.Nomt4 = 'havamt4';
                // alert($scope.message[$scope.Language].loginOut);
                $scope.clearSession();
            }
        })
    };
    $scope.user();

    $scope.ExistAccountBankInfoFlag = false;
    $scope.AccountBankInfo = {
        'Country': '', 'BankCode': '', 'DepositaryBank': '', 'OwnerOfAccount': '',
        'BankAccountNumber': '', 'Address': '', 'Zipcode': '', 'SwiftBicCode': '', 'PhoneNumber': ''
    };
    $scope.getAccountBankInfo = function () {
        $scope.matrixPost(true, "/MyInfo/GetAccountBankInfo", {}, function (res) {
            if (res.Success) {
                if (res.Data) {
                    $scope.ExistAccountBankInfoFlag = true;
                    $scope.AccountBankInfo = res.Data;
                } else {
                    $scope.ExistAccountBankInfoFlag = false;
                }
            } else if (res.IsLogin == false) {
                $scope.clearSession();
            }
        })
    };
    $scope.getAccountBankInfo();

    $scope.saveBankInfo = function (valid) {
        if (!$('#myFormBankInfo').valid()) {
            return false;
        }
        $scope.matrixPost(true, "/MyInfo/SaveAccountBankInfo", $scope.AccountBankInfo, function (res) {
            if (res.Success) {
                alert($scope.message[$scope.Language].success);
                $scope.ExistAccountBankInfoFlag = true;
            } else if (res.IsLogin == false) {
                $scope.clearSession();
            } else {
                alert(res.Message);
            }
        })
    };

    $scope.getCountry = function () {
        $http.get('/script/country.json').success(function (data) {
            $scope.countryEntitys = data;
        })
    };

    $scope.getCountry();

    $scope.sure_apply = function (valid) {
        if (!$('#myFromApply').valid()) {
            return false;
        }
        if (!$scope.ExistAccountBankInfoFlag) {
            alert('Please add bank information first.', true);
            return false;
        }
        if($scope.ApplyData.USDmoney<=0){
            if($scope.Language =='en'){
                alert('The amount must be greater than 0');
            }else{
                alert('金额必须大于0');
            }
            return false;
        }

        var apply = $scope.ApplyData;
        var bankInfo = $scope.AccountBankInfo;
        if (typeof bankInfo.DepositaryBank == "undefined" || bankInfo.DepositaryBank == null || bankInfo.DepositaryBank == "") {
            alert('Please check your bank information, add bank name, this field is required.', true);
            return false;
        }
        var data = {
            'money': apply.USDmoney,
            'country': bankInfo.Country,
            'bankCode': bankInfo.BankCode,
            'bankNumber': bankInfo.BankAccountNumber,
            'bankName': bankInfo.DepositaryBank,
            'bankAccountName': bankInfo.OwnerOfAccount,
            'address': bankInfo.Address,
            'zipcode': bankInfo.Zipcode,
            'bankPhone': bankInfo.PhoneNumber,
            'swiftbiccode': bankInfo.SwiftBicCode
        }
        $scope.matrixPost(true, "/WebTrade/RefundRecord", data, function (res) {
            if (res.Success) {
                alert($scope.message[$scope.Language].success);
                //跳转到出金记录
                $location.path("/center/manage/RefundRecords");
            } else if (res.IsLogin == false) {
                // alert($scope.message[$scope.Language].loginOut);
                $scope.clearSession();
            } else {
                alert(res.Message);
            }
        })
    }
	
	$scope.sure_apply_usdt = function (valid) {
        if (!$('#myFromApplyUsdt').valid()) {
            return false;
        }
        if ($scope.ApplyDataUsdt.USDmoney <= 0) {
            if ($scope.Language == 'en') {
                alert('The amount must be greater than 0');
            } else {
                alert('金额必须大于0');
            }
            return false;
        }
        // console.log($scope.ApplyData);
        var apply = $scope.ApplyDataUsdt;
        var data = {
            'money': apply.USDmoney,
            'bankNumber': apply.bankNumber,
            'bankName': apply.bankName,
            'bankAccountName': 'USDT提现',
            'bankPhone': 'USDT提现',
        }
        $scope.matrixPost(true, "/WebTrade/RefundRecord", data, function (res) {
            if (res.Success) {
                alert($scope.message[$scope.Language].success);
                $location.path("/center/manage/RefundRecords");
            } else if (res.IsLogin == false) {
                $scope.clearSession();
            } else {
                alert(res.Message);
            }
        })
    }
}]);
myApp.controller('passwordController', function ($scope, $location, $timeout) {
    //修改密码
    // $scope.judgeLogin()
    $scope.change = function (valid) {
        $scope.AccountStatus();
        if (!valid) {
            alert($scope.message[$scope.Language].vaild);
            return false;
        }
        $scope.NewPassword = $scope.NewPassword.replace(/\s+/g, '');
        var params = {
            "lodpwd": $scope.OldPassword,
            "newpwd": $scope.NewPassword
        }
        $scope.matrixPost(true, "/MyInfo/ChangePwd", params, function (res) {
            if (res.Success) {
                // alert('修改成功，请重新登录!');
                alert($scope.message[$scope.Language].success);
                $timeout(function () {
                    $location.path('/login');//重新登录
                    $scope.clearSession(); //清除session
                }, 800);
                // $scope.password=$scope.NewPassword
            } else if (res.IsLogin == false) {
                $scope.clearSession();
            } else {
                alert(res.Message);
            }
        })
    }
});
myApp.controller('depositController', ['$scope', '$location','$timeout', function ($scope, $location,$timeout) {
    $scope.deposit = {'bankCode':'','stepClass':'step1','moneyType':'','realname': '', 'USDmoney': '', 'CNYmoney': '', 'bankHeadOffice': '', 'bankNumber': '', 'accountName': '', 'Rate': '','imgSrc':'' };
    $scope.getRates('',$scope.deposit);
    $scope.Next = function(){
        if($scope.deposit.USDmoney<=0){
            if($scope.Language =='en'){
                alert('The amount must be greater than 0');
            }else{
                alert('金额必须大于0');
            }
            return false;
        }
        var data = {
            'amount':parseFloat($scope.deposit.USDmoney),
            'currency':$scope.CurrencyType,
            'paytype':$scope.deposit.moneyType
        };
        $scope.matrixPost(true, "/Royalpay/GetPayInfo", data, function (res) {
            if(res.Success){ 
                $scope.ShowWeChart = true;
                $('.wechart').fadeIn(200);
                $scope.deposit.imgSrc = res.Data.Result;
                $('.wechart').unbind('click').bind('click',function(){
                    $(this).fadeOut(200);
                });
            }else if (!res.IsLogin) {
                $scope.clearSession();
            } else {
                alert(res.Message);
            }
        })  
    };
    // console.log('myd');
    $scope.UnionpayNext = function(){
        if($scope.deposit.USDmoney<=0){
            if($scope.Language =='en'){
                alert('The amount must be greater than 0');
            }else{
                alert('金额必须大于0');
            }
            return false;
        }
        // if(!$scope.deposit.bankCode && $scope.deposit.moneyType =='unionpay'){
        //     if($scope.Language =='en'){
        //         alert('please choice bank');
        //     }else{
        //         alert('请选择银行');
        //     } 
        //     return false;
        // }
        if($scope.deposit.moneyType =='unionpay'){
            var data = {
                'amount':parseFloat($scope.deposit.USDmoney),
                'currency':$scope.CurrencyType,
                // 'currency':'AUD',
                'paytype':$scope.deposit.moneyType
                // 'bank_segment':$scope.deposit.bankCode//银行代码
            };
        }else{
            var data = {
                'amount':parseFloat($scope.deposit.USDmoney),
                'currency':$scope.CurrencyType,
                // 'currency':'AUD',
                'paytype':$scope.deposit.moneyType
            };
        }
        // console.log(data);
        // debugger
        $scope.matrixPost(true, "/Royalpay/GetPayInfo", data, function (res) {
            if(res.Success){ 
                // console.log(res);
                // debugger

                // if($scope.deposit.moneyType =='unionpay'){
                //     // Unionpay(res.Data.Result,res.Data.FormUrl);
                //     $('#unipayherf').attr('href',res.Data);
                //     // $timeout(function(){
                //         document.getElementById('unipayherf').click();
                //     // },100)
                // }else{
                    Unionpay(res.Data.Result,res.Data.FormUrl); 
                // }
                // $scope.ShowWeChart = true;
                // $('.wechart').fadeIn(200);
                // $scope.deposit.imgSrc = res.Data;
                // $('.wechart').unbind('click').bind('click',function(){
                //     $(this).fadeOut(200);
                // });
            }else if (!res.IsLogin) {
                $scope.clearSession();
            } else {
                alert(res.Message);
            }
        })
        //动态创建form
        function Unionpay(datas,actionUrl){
            // delete datas.sign;
            // delete datas.extend_param; 
            var dom = $('.formdatas');
            // target="_black"
            dom.append('<form style="display:none;" method="post" id="thisform" action="'+actionUrl+'"></form>');
            var thisform = $('#thisform');
            for(var key in datas){
                var tpl = '<input type="text" name="'+key+'" value="'+datas[key]+'">'; 
                thisform.append(tpl);
            }
            thisform.append('<input class="submit" type="submit">');
            thisform.find('.submit').click();
        //    console.log(datas); 
        }
    };
    //下一步
    $scope.NextStep = function(type){
        if(type == 'step1'){
            $scope.deposit.stepClass = 'step1';  
        }else{
            if(!$scope.deposit.moneyType){
                alert($scope.Language=='en'?'Please choose payment method':'请选择支付方式');
                return false;
            }
            $scope.deposit.stepClass = 'step2';
        }
    }
    $scope.showImgb = function(type){
        
        if(arguments[0] == 'wedels'){
            $('#wedels').fadeIn(200);
            $('#wedels').click(function(){
                $('#wedels').fadeOut(200);
            })
        }else{
            $('#alipaydels').fadeIn(200);
            $('#alipaydels').click(function(){
                $('#alipaydels').fadeOut(200);
            })
        }
    }
    // $scope.IframeUrl = '';
    // // $scope.judgeLogin();
    // // console.log('哈哈');
    // if ($scope.Language == 'en') {
    //     $location.path('/center/manage/BankDeposit');
    // }
    // // console.log('membercenter');
    // $scope.user = function () {
    //     $scope.AccountStatus();
    //     $scope.matrixPost(false, "/WebTrade/GetApplyUrl", {}, function (res) {
    //         if (res.Success == true) {
    //             $scope.resInfo = res.Data;
    //             $scope.IframeUrl = res.Data;
    //             // console.log(res.Data)
    //             // console.log($scope.IframeUrl);
    //         } else if (res.IsLogin == false) {
    //             $scope.clearSession();
    //         } else {
    //             alert(res.Message);
    //         }
    //     })
    // }
    // $scope.user();
    // openWaitingModal();
}]);
//动态添加iframe
myApp.directive('viewIframe', ['$timeout', function ($timeout) {
    return {
        restrict: 'AE',
        link: function (scope, element, attrs) {
            // document.getElementById("iframe").contentDocument.getElementById("div_id").value;
            //获取支付窗口
            scope.AccountStatus();
            scope.matrixPost(false, "/WebTrade/GetApplyUrl", {}, function (res) {
                if (res.Success == true) {
                    setIframe(res.Data);
                } else if (res.IsLogin == false) {
                    $scope.clearSession();
                } else {
                    $('.pay-box').removeClass('shows');
                    $('.spin_boxmin').addClass('show-loading');
                    alert(res.Message);
                }
                // else{
                //     var data = $scope.language=='en'?'Failed to obtain URL':'未能获取到url';
                //     // $('.load').html(data);
                //     $('.pay-box').removeClass('shows');
                //     $('.spin_boxmin').addClass('show-loading');
                // }
            });
            function setIframe(src) {
                var str = "<iframe id='iframe' src='" + src + "'></iframe>";
                $(element).append(str);
                var iframe = $('#iframe')[0];
                if (iframe.attachEvent) {
                    iframe.attachEvent("onload", function () {
                        $('.spin_boxmin').addClass('show-loading');
                        $('.pay-box').removeClass('shows');
                    });
                } else {
                    iframe.onload = function () {
                        $('.spin_boxmin').addClass('show-loading');
                        $('.pay-box').removeClass('shows');
                    };
                }
            }
        }
    };
}]);
myApp.controller('findpasswordController', ['$scope', function ($scope) {
    $('body').removeClass('bg-black');
    $scope.sedEmail = function () {
        if (!$('#fomrssd').valid()) {
            return false;
        }

        var data = {
            'language': $scope.Language,
            'email': $scope.email
        }
        $scope.matrixPost(true, "/WebLogin/ForgetPwd", data, function (res) {
            if (res.Success) {
                alert($scope.message[$scope.Language].Email);
                // alert($scope.message[$scope.Language=='en'?'english':'chinese'].Email);
            } else if (res.IsLogin == false) {
                // alert($scope.message[$scope.Language].loginOut);
                $scope.clearSession();
            } else {
                alert(res.Message);
            }
        })
    }
}]);
myApp.controller('historyController', ['$scope', 'PagesService', function ($scope, PagesService) {
    $scope.repotdata = { 'data': '', 'starttime': new Date('2017-2-9'), 'endtime': new Date(PagesService.getCurrentTime()), 'type': '0', 'error': '' };
    $scope.judgeLogin();
    $scope.getHistroy = function () {
        var data = {
            'start': $scope.repotdata.starttime,
            'end': $scope.repotdata.endtime,
            'sstats': parseInt($scope.repotdata.type)
        }
        $scope.matrixPost(false, "/WebTrade/GetProfitReport", data, function (res) {
            if (res.Success) {
                $scope.repotdata.data = res.Data;
                // $scope.orderdata.page = PagesService.pages(res.Data.TotalCount,data.pageSize,data.pageIndex);
            } else if (res.IsLogin == false) {
                $scope.clearSession();
            } else {
                alert(res.Message);
            }
        });
    }
    $scope.getHistroy();
}]);
myApp.controller('mt4Controller', function ($scope, $http, $location, $timeout, $compile) {
    // $scope.mt4_data ='';
    $scope.judgeLogin();
    $scope.user = function () {
        $scope.matrixPost(true, "/MyInfo/GetNowInfo", {}, function (res) {
            if (res.Success) {
                $scope.resInfo = res.Data;
                // console.log(res)
            } else if (res.IsLogin == false) {
                $scope.clearSession();
            } else {
                alert($scope.message[$scope.Language].getError);
            }
        })
    }
    $scope.user();
});
myApp.controller('resetpasswordController', ['$scope', '$location', function ($scope, $location) {
    $scope.pass = { 'newPassw': '', 'Passw': '', 'Email': '' }
    // console.log($location.search().code);
    $('body').removeClass('bg-black');
    $scope.sureEdit = function () {
        var data = {
            // 'language':$scope.Language,
            'email': $scope.pass.Email,
            'newpwd1': $scope.pass.Passw,
            'newpwd2': $scope.pass.Passw,
            'code': $location.search().code
        }
        $scope.matrixPost(true, "/WebLogin/ChangePwd", data, function (res) {
            if (res.Success) {
                alert($scope.message[$scope.Language].success);
                $location.path("/login");
            } else {
                alert(res.Message);
            }
        })
    }
}]);
//银行入金
myApp.controller('uploadController', ['$scope', '$http', '$location', '$timeout', '$compile', 'Upload', function ($scope, $http, $location, $timeout, $compile, Upload) {
    // $scope.type='BankDeposit';
    $scope.incomeData = { 'realname': '', 'email': '', "MT4Account": '', 'USDmoney': '', 'CNYmoney': '', 'Rate': '', 'depositImage': '' };
    //获取用户信息.
    $scope.getRates('',$scope.incomeData);
    $scope.user = function () {
        $scope.AccountStatus();
        $scope.matrixPost(true, "/MyInfo/GetInfo", {}, function (res) {
            $scope.Nomt4 = 'havamt4';
            if (res.Success && !res.Data.IsChecke) {
                // $timeout(function(){
                //     $location.path('/center/AccountInfo');
                // },300);
                $scope.Nomt4 = 'nomts';
                // alert($scope.Language!='en'?'MT4账户审核中，不能进行银行入金':'MT4 Account is under review,Can not be out of gold management');
            } else if (res.Success) {
                $scope.incomeData.realname = res.Data.RealName;
                $scope.incomeData.email = res.Data.Email;
                $scope.incomeData.MT4Account = res.Data.MT4Account;
            } else if (res.IsLogin == false) {
                $scope.clearSession();
            } else {
                alert(res.Message);
            }
        })
    };
    // $location.path("/center/manage/PaymentRecords");
    $scope.user();

    $scope.payChannels = function () {
        $scope.AccountStatus();
        $scope.matrixPost(true, "/Royalpay/GetEnableChannelList", {}, function (res) {
            if (res.Success == true) {
                $scope.channelsData = res.Data;
            } else if (res.IsLogin == false) {
                $scope.clearSession();
            } else {
                alert(res.Message);
            }
        });
    };
    $scope.payChannels();

    //special paymethod channel
    $scope.ExistWireTransfer = false;
    $scope.ExistOtcpays = false;
    $scope.ExistSkrill = false;
    $scope.ExistSticpay = false;
	$scope.payMethods = function(){
        $scope.AccountStatus();
        $scope.matrixPost(true, "/Royalpay/GetPayMethods", {}, function (res) {
            if (res.Success == true) {
                $scope.resData = res.Data;
                $.each($scope.resData, function (index, entity) {
                    if (entity.Channel == 'Otcpays') {
                        $scope.ExistOtcpays = true;
                    }
                    if (entity.Channel == 'WireTransfer') {
                        $scope.ExistWireTransfer = true;
                    }
                    if (entity.Channel == 'Skrill') {
                        $scope.ExistSkrill = true;
                    }
                    if (entity.Channel == 'Sticpay') {
                        $scope.ExistSticpay = true;
                    }
                });
            } else if (res.IsLogin == false) {
                $scope.clearSession();
            } else {
                alert(res.Message);
            }
        });
    };
    $scope.payMethods();
	$scope.usdtrate = 1;
	$scope.getUSDTRate = function(){
        $scope.AccountStatus();
        $scope.matrixPost(true, "/Royalpay/GetUSDTRateUSD", {}, function (res) {
            if (res.Success == true) {
                $scope.usdtrate = res.Data.price;
            } else if (res.IsLogin == false) {
                $scope.clearSession();
            } else {
                alert(res.Message);
            }
        });
    };
    $scope.getUSDTRate();

    $scope.WireTransferCurrencyRate = 1;
    //transfer bank get other currency exchange usd
    $scope.getWireTransferCurrencyRateByCurrency = function (currency) {
        $scope.deposit.WireTransferCurrency = currency;
        if (currency == 'USD') {
            $scope.WireTransferCurrencyRate = 1;
            return;
        }
        $scope.AccountStatus();
        $scope.matrixPost(true, "/Royalpay/GetWireTransferCurrencyRateByCurrency", { "currency": currency }, function (res) {
            if (res.Success == true) {
                $scope.WireTransferCurrencyRate = res.Data.price;
            } else if (res.IsLogin == false) {
                $scope.clearSession();
            } else {
                alert(res.Message);
            }
        });
    };
    $scope.sure = function () {
        if (!$('#fomrssd').valid()) {
            return false;
        }
        if($scope.incomeData.USDmoney<=0){
            if($scope.Language =='en'){
                alert('The amount must be greater than 0');
            }else{
                alert('金额必须大于0');
            }
            return false;
        }

        var data = {
            'usdMoney': $scope.incomeData.USDmoney,
            'cnyMoney': $scope.incomeData.CNYmoney,
            'channel': $scope.deposit.moneyType,
            'photo': $scope.incomeData.depositImage,
            'currency': $scope.deposit.WireTransferCurrency,
            'targetCurrencyToUSDRate': $scope.WireTransferCurrencyRate
        }

        // debugger
        $scope.matrixPost(true, "/WebTrade/BankPayRecord", data, function (res) {
            if (res.Success) {
                alert($scope.message[$scope.Language].success);
                //跳转到入金记录
                $location.path("/center/manage/PaymentRecords");
            } else if (res.IsLogin == false) {
                $scope.clearSession();
            } else {
                alert(res.Message);
            }
        })
    }
    // 注册上传图片
    $scope.commondialogOption = {
        'uploadImgNocrop': function (config, Path, file) {
            // require(['upload','uploadshim'],function() {
            //     myApp.useModule("ngFileUpload");
            //     var Upload=myApp.get('Upload');
            var url = $scope.SimpleUrl + '/IBWebApi/WebLogin/UpLoadImage';
            $scope.loading = true;
            // console.log(config);
            // return false;
            Upload.upload({
                //服务端接收
                url: url,
                file: file,
                headers: {
                    'Content-Language': $scope.Language
                }
            }).progress(function (evt) {
                //进度条
                var progressPercentage = parseInt(100.0 * evt.loaded / evt.total);
                console.log(evt.total);
                // console.log(evt.total);
            }).success(function (callbackData) {
                $scope.loading = false;
                if (callbackData.Success) {

                    // 为card赋值,注册时使用
                    $scope.incomeData[config.card] = callbackData.Data;
                    // // 为card赋值,注册时使用
                    // $scope.registerform[config.card] = callbackData.Data;
                    alert($scope.message[$scope.Language].success);
                    $(config.triggerCls).hide();
                    // $(config.shows).attr('src','http://192.168.3.200:8012/'+callbackData.Data)
                    // $scope.getimglist();
                } else {
                    alert(callbackData.Message);
                }
            }).error(function (data, status, headers, config) {
                $scope.loading = false;
                alert($scope.message[$scope.Language].getError);
            });
            // });
        }
    }
    //在线入金
    $scope.deposit = {'bankCode':'','stepClass':'step1','moneyType':'','realname': '', 'USDmoney': '', 'CNYmoney': '', 'bankHeadOffice': '', 'bankNumber': '', 'accountName': '', 'Rate': '','imgSrc':'' };
    $scope.getRates('',$scope.deposit);
    $scope.Next = function(){
        if($scope.deposit.USDmoney<=0){
            if($scope.Language =='en'){
                alert('The amount must be greater than 0');
            }else{
                alert('金额必须大于0');
            }
            return false;
        }
        var data = {
            'amount':parseFloat($scope.deposit.USDmoney),
            'currency':$scope.CurrencyType,
            'paytype':$scope.deposit.moneyType
        };
        $scope.matrixPost(true, "/Royalpay/GetPayInfo", data, function (res) {
            if(res.Success){ 
                $scope.ShowWeChart = true;
                $('.wechart').fadeIn(200);
                $scope.deposit.imgSrc = res.Data.Result;
                $('.wechart').unbind('click').bind('click',function(){
                    $(this).fadeOut(200);
                });
            }else if (!res.IsLogin) {
                $scope.clearSession();
            } else {
                alert(res.Message);
            }
        })  
    };
    // console.log('myd');
    $scope.UnionpayNext = function () {
        if ($scope.deposit.moneyType.indexOf('otcpaysdigital') >= 0) {
            //if select digital currency, no input required
            
        } else {
            if ($scope.deposit.USDmoney < 100) {
                if ($scope.Language == 'en') {
                    alert('The amount must be at least 100', true);
                } else {
                    alert('金额至少100', true);
                }
                return false;
            }
        }

        if ($scope.deposit.moneyType == 'starpayeur' ||
            $scope.deposit.moneyType == 'starpaycad' ||
            $scope.deposit.moneyType == 'starpaygbp' ||
            $scope.deposit.moneyType == 'otcpayseur' ||
            $scope.deposit.moneyType == 'otcpayscad' ||
            $scope.deposit.moneyType == 'otcpaysgbp' ||
            $scope.deposit.moneyType == 'otcpaysaud' ||
            $scope.deposit.moneyType == 'otcpayscny' ||
            $scope.deposit.moneyType == 'sticpayusd'
            ) {

                var data = {
                    'amount': parseFloat($scope.deposit.USDmoney),
                    'currency': $scope.usdtcurrency,
                    'bank_segment': $scope.deposit.bankCode,
                    'paytype': $scope.deposit.moneyType,
                    'bankno': $scope.deposit.BankNo,
                    'phone': $scope.deposit.Phone,
                    'name': $scope.deposit.Name
                };
        } else if ($scope.deposit.moneyType.indexOf('otcpaysdigital') >= 0) {
            var data = {
                'amount': parseFloat($scope.deposit.USDmoney),
                'currency': $scope.usdtcurrency,
                'paytype': $scope.deposit.moneyType
            };
            
        } else {
            var data = {
                'amount': parseFloat($scope.deposit.USDmoney),
                'currency': $scope.CurrencyType,
                'bank_segment': $scope.deposit.bankCode,
                'paytype': $scope.deposit.moneyType,
                'bankno': $scope.deposit.BankNo,
                'phone': $scope.deposit.Phone,
                'name': $scope.deposit.Name
            };
        }

        $.ajax({
            url: $scope.SimpleUrl + "/Royalpay/GetPayInfo",
            type: "post",
            dataType: "JSON",
            cache: false,
            async: false,
            headers: {
                'Authorization': sessionStorage.getItem('token'),
                'Content-Language': $scope.Language
            },
            data: data,
            beforeSend: function () {
                $('#postBox').css('display', 'block');
            },
            success: function (res) {
                $('#postBox').css('display', 'none');
                if (res.Success) {
                    if(
                        $scope.deposit.moneyType == 'starpayusd' ||
                        $scope.deposit.moneyType == 'starpayeur' ||
                        $scope.deposit.moneyType == 'starpaycad' ||
                        $scope.deposit.moneyType == 'starpaygbp' ||
                        $scope.deposit.moneyType == 'otcpaysusd' ||
                        $scope.deposit.moneyType == 'otcpayseur' ||
                        $scope.deposit.moneyType == 'otcpayscad' ||
                        $scope.deposit.moneyType == 'otcpaysgbp' ||
                        $scope.deposit.moneyType == 'otcpaysaud' ||
                        $scope.deposit.moneyType == 'otcpayscny' ||
                        $scope.deposit.moneyType.indexOf('otcpaysdigital') >= 0 ||
                        $scope.deposit.moneyType == 'skrill_quick_checkout' ||
                        $scope.deposit.moneyType == 'sticpayusd'
                    ) {
						Unionpay(res.Data.Result, res.Data.FormUrl);
					}
					else {
                        //console.log(res.Data);
                        //$scope.htmlLoad = res.Data;
                        //myopenwindow = window.open('about:blank');
                        //myopenwindow.document.write(res.Data);
						if (res.Data.Paytype == "alipay" ||
							res.Data.Paytype == "alipay2") {
                            var aliUrl = res.Data.FormUrl+"?";
                            for (var key in res.Data.Result) {
                                aliUrl += (key +"="+ res.Data.Result[key] + "&");
                            }
                            myopenwindow = window.open(aliUrl);
                        }
                        else {
                            $scope.htmlLoad = res.Data;
                            myopenwindow = window.open('about:blank');
							myopenwindow.document.write(res.Data);
                        }
						
                       // $timeout(function () {
                           // $(document.AutoForm).attr('target', '_blank');
                            //('#formBox form').submit();
                       //     //document.AutoForm.submit();
                       // }, 300);
                    }
                }
                else if (res.isLogin) {
                    $scope.clearSession();
                }
                else {
                    alert(res.Message);
                }
            },
            error: function () {
                $('#postBox').css('display', 'none');
            }
        });
        //动态创建form
        function Unionpay(datas,actionUrl){
            // delete datas.sign;
            // delete datas.extend_param; 
            var dom = $('.formdatas');
            // target="_black"
            dom.append('<form style="display:none;" method="post" id="thisform" action="'+actionUrl+'"></form>');
            var thisform = $('#thisform');
            for(var key in datas){
                var tpl = '<input type="text" name="'+key+'" value="'+datas[key]+'">'; 
                thisform.append(tpl);
            }
            thisform.append('<input class="submit" type="submit">');
            thisform.find('.submit').click();
        //    console.log(datas); 
        }
    };
    //add 2019年10月28日
    $scope.usdtcurrency = "USD";
    //add 2019年10月28日
    //根据不同货币获取 usdt汇率
    $scope.getUSDTRateByCurrency = function (currency) {
        $scope.AccountStatus();
        $scope.matrixPost(true, "/Royalpay/GetUSDTRateByCurrency", { "currency": currency }, function (res) {
            if (res.Success == true) {
                $scope.usdtrate = res.Data.price;
                $scope.usdtcurrency = res.Data.currency;
            } else if (res.IsLogin == false) {
                $scope.clearSession();
            } else {
                alert(res.Message);
            }
        });
    };
    $scope.selChannel = function (type) {
        if (type == 'WireTransfer') {
            $scope.deposit.moneyType = type;
            $scope.deposit.stepClass = 'step3';
        } else {
            $scope.deposit.moneyType = '';
            $scope.deposit.stepClass = 'step2';
        }
        $scope.deposit.channelType = type;
    };
    $scope.selPayMethod = function (method) {
        $scope.deposit.moneyType = method;
        $scope.NextStep('step3');
    };
    $scope.filterChannelType = function (pay) {

        return pay.Channel == $scope.deposit.channelType;

    };
    //下一步
    $scope.NextStep = function(type){
        if(type == 'step1'){
            $scope.deposit.stepClass = 'step1';  
        } else if (type == 'step2') {
            $scope.deposit.stepClass = 'step2';
        } else {
            if(!$scope.deposit.moneyType){
                alert($scope.Language=='en'?'Please choose payment method':'请选择支付方式');
                return false;
            }
            //add by lzj 2019年10月28日
            //如果选择starpay其他货币进行付款的时候，获取响应货币的USDT汇率
            if ($scope.deposit.moneyType == 'starpayeur' ||
                $scope.deposit.moneyType == 'starpaycad' ||
                $scope.deposit.moneyType == 'starpaygbp' ||
                $scope.deposit.moneyType == 'otcpayseur' ||
                $scope.deposit.moneyType == 'otcpayscad' ||
                $scope.deposit.moneyType == 'otcpaysgbp' ||
                $scope.deposit.moneyType == 'otcpaysaud' ||
                $scope.deposit.moneyType == 'otcpayscny' ||
                $scope.deposit.moneyType == 'sticpayusd'
            ) {
                var postcurrency = $scope.deposit.moneyType.substring(7, 10);
                $scope.getUSDTRateByCurrency(postcurrency);
            }
            $scope.deposit.stepClass = 'step3';
        }
    }
    $scope.showImgb = function(type){
        
        if(arguments[0] == 'wedels'){
            $('#wedels').fadeIn(200);
            $('#wedels').click(function(){
                $('#wedels').fadeOut(200);
            })
        }else{
            $('#alipaydels').fadeIn(200);
            $('#alipaydels').click(function(){
                $('#alipaydels').fadeOut(200);
            })
        }
    }
}]);
myApp.controller('payController', ['$scope', function ($scope) {

      function wap_pay() {
           var responseText = localStorage.getItem('payData');
        var response = angular.copy(responseText);
        response = JSON.parse(response);
        // response = JSON.parse('{"code": "102","msg": "签名验证失败"}');
        if(response.hasOwnProperty('code')){
            $('#errorMes').html(response.msg+',请重试或联系客服');
            return false;
        }
        paymentjs.createPayment(responseText, function (result, err) {
            console.log(result);
            console.log(err.msg);
            console.log(err.extra);
        });
    }
	 $('#errorMes').html('');
    wap_pay();

}])
myApp.controller('accountController', ['$scope', '$http', '$location', '$timeout', 'Upload', 'fieldService', function ($scope, $http, $location, $timeout, Upload, fieldService) {
    //个人开户注册信息
    $scope.registerform = {
        'currency':'USD','surname': '', 'sname': '', 'phone': '', 'email': '', 'reemail': '', 'gender': $scope.Language == 'en' ? 'Male' : '男', 'password': '', 'passwordagain': '', 'agentCode': $location.search().code,
        'cardtype': '', 'addressImage': '', 'cardnumber': '', 'cardfront': '', 'cardnagitive': '', 'address': '', 'birthday': '', 'age': '18~25', 'gupiao': { 'value': '', 'type': '' },
        'foreign': { 'value': '', 'type': '' }, 'futures': { 'value': '', 'type': '' }, 'option': { 'value': '', 'type': '' }, 'contract': { 'value': '', 'type': '' },
        'fund': { 'value': '', 'type': '' }, 'income': '', 'assetvalue': '', 'bankImage': '', 'bankName': '', 'bankAcount': '', 'bankNumber': '', 'dynamicProperties': {}
    };
    //机构开户注册信息:
    $scope.registercomp = {
        'currency':'USD','surname': '', 'sname': '', 'phone': '', 'email': '', 'reemail': '', 'password': '', 'passwordagain': '', 'agentCode': $location.search().code,
        'cardtype': '', 'cardnumber': '', 'cardfront': '', 'cardnagitive': '', 'address': '', 'birthday': '', 'age': '', 'income': '', 'assetvalue': '',
        'howKnow': '', 'compa_num': '', 'compa_name': '', 'compa_address': '', 'compa_country': $scope.Language == 'en' ? 'China' : '中国', 'bankImage': '', 'bankName': '', 'bankAcount': '', 'bankNumber': '', 'dynamicProperties': {}
    };
    $scope.currencyRegiste = 'USD';
    $('body').removeClass('bg-black');
    $scope.lags = $scope.Language;
    // console.log($location.search().code);
    $scope.exprice = {};//交易经验，指令中操作赋值.
    $scope.registerStep = 'step1';//注册步骤跳转
    $scope.nextStep = function (type) {
        // console.log(isValid);
        var step = $scope.registerStep.substr($scope.registerStep.length - 1, 1);
        switch (type) {
            case 'pre'://上一步
                step--;
                $scope.registerStep = 'step' + step;
                // $scope.registercomp.cardfront='';
                // $scope.registerform.cardfront='';
                // $scope.registerform.cardnagitive='';
                // $scope.registerform.addressImage='';
                // $('#forms').valid();


                break;
            case 'next'://下一步
                // console.log($scope.registercomp);
                //     if(isValid){
                if (!$('#forms').valid()) {
                    return false;
                }

                $timeout(function () {
                    step++;
                    $scope.registerStep = 'step' + step;
                }, 100)
                // }else{
                //     alert($scope.message[$scope.Language].vaild);
                // }
                break;
        }
    }
    //推广链接注册
    $scope.agentCode = $location.search()["code"];
    //个人注册
    $scope.registerPosting = false;
    $scope.EmailBlur = function () {
        console.log('email blur');
        var reg1 = /([\w-\.]+)@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.)|(([\w-]+\.)+))([a-zA-Z]{2,4}|[0-9]{1,3})(\]?)/;
        if (reg1.test($('input[name=email]').val()) == false) {
            console.log('illegal email address');
            return;
        } else {
            $scope.matrixPost(true, "/WebLogin/CheckEmailExist", { "email": $('input[name=email]').val() }, function (res) {
                if (res.Success) {
                    console.log('email can register');
                    return;
                    
                } else {
                    console.log('email exist');
                    alert(res.Message, true);
                }
            });
        }
    }
    $scope.register = function (isValid) {
        $scope.registerPosting = true;
        if (!$('#forms').valid()) {
            $scope.registerPosting = false;
            return false;
        }
        var params = {
            // ""
            "Email": $scope.registerform.email,
            "Pwd": $scope.registerform.password,
            // "Country": $scope.country,
            "PhoneNumber": $scope.registerform.phone,
            "AgentCode": $scope.registerform.agentCode,
            "Address": $scope.registerform.address,
            "DateOfBirth": $scope.registerform.birthday,
            "Language": $scope.Language,
            "RealName": $scope.registerform.sname + $scope.registerform.surname,
            // "QQ": $scope.qq,
            "Gender": $scope.registerform.gender,
            'Age': $scope.registerform.age,
            "CertificateCardType": $scope.registerform.cardtype,
            "CertificateCardNumber": $scope.registerform.cardnumber,
            "AnnualIncome": $scope.registerform.income,
            "TotalAssets": $scope.registerform.assetvalue,
            "CardNumber1": $scope.registerform.cardfront,
            "CardNumber2": $scope.registerform.cardnagitive,
            "AddressPhoto": $scope.registerform.addressImage,
            "TradingExperience": JSON.stringify($scope.exprice),
            "BankHeadOffice": $scope.registerform.bankName,
            "BranchOfficeOfBankAccount": $scope.registerform.bankAcount,
            "BankNumber": $scope.registerform.bankNumber,
            "BankPhoto": $scope.registerform.bankImage,
            "Type": 0,//0个人注册
            "CurrencyType": $scope.currencyRegiste,//货币类型
            "DynamicProperties": JSON.stringify($scope.registerform.dynamicProperties, undefined, 2)
        }
        $scope.matrixPost(true, "/WebLogin/Register", params, function (res) {
            if (res.Success) {
                $scope.registerPosting = false;
                // console.log(res)
                $scope.resInfo = res.Data;
                $location.path("/login");
                alert($scope.message[$scope.Language].success);
            } else {
                $scope.registerPosting = false;
                alert(res.Message);
            }
        });
    }
    //机构注册
    $scope.registercomps = function () {
        if (!$('#forms').valid()) {
            return false;
        }
        // console.log($scope.registercomp);
        var params = {
            "Email": $scope.registercomp.email,
            "Pwd": $scope.registercomp.password,
            // "Country": $scope.registercomp.country,
            "PhoneNumber": $scope.registercomp.phone,
            "AgentCode": $scope.registercomp.agentCode,
            "Address": $scope.registercomp.address,
            // "DateOfBirth": $scope.registercomp.birthday,
            "Language": $scope.Language,
            "RealName": $scope.registercomp.surname,
            'CompanyNumber': $scope.registercomp.compa_num,
            'RigsterName': $scope.registercomp.compa_name,
            'RigsterAddress': $scope.registercomp.compa_address,
            'RigsterCountry': $scope.registercomp.compa_country,
            // "QQ": $scope.qq,
            // "Gender": $scope.sex,
            // "CertificateCardType": $scope.registercomp.cardtype,
            // "CertificateCardNumber": $scope.hm,
            "CardNumber1": $scope.registercomp.cardfront,//机构证件
            "CardNumber2": $scope.registercomp.cardnagitive,//机构证件
            "AnnualIncome": $scope.registercomp.income,
            "TotalAssets": $scope.registercomp.assetvalue,
            "BankHeadOffice": $scope.registercomp.bankName,
            "BranchOfficeOfBankAccount": $scope.registercomp.bankAcount,
            "BankNumber": $scope.registercomp.bankNumber,
            "BankPhoto": $scope.registercomp.bankImage,
            // "TradingExperience": $scope.experience,
            "Type": 1,//机构注册
            "CurrencyType": $scope.currencyRegiste,//货币类型
            "DynamicProperties": JSON.stringify($scope.registercomp.dynamicProperties, undefined, 2)
        }
        // console.log(params);

        $scope.matrixPost(true, "/WebLogin/Register", params, function (res) {
            if (res.Success) {
                // console.log(res)
                $scope.resInfo = res.Data;
                // alert("注册成功!");
                $location.path("/index");
                alert($scope.message[$scope.Language].success);
                //机构注册成功后跳转地址
                $timeout(function () {
                    // $window.location.href=$scope.CompLoginUrl;
                }, 200);
                // $scope.matrixPost(true, "/WebBrand/GetSiteInfo", params, function (res) {})
            } else {
                alert(res.Message);
            }
        });
    }
    // 注册上传图片
    $scope.commondialogOption = {
        'uploadImgNocrop': function (config, Path, file) {
            $scope.loading = true;
            // console.log($scope.loading);
            // require(['upload', 'uploadshim'], function () {
            //     myApp.useModule("ngFileUpload");
            //     var Upload = myApp.get('Upload');
            var url = $scope.SimpleUrl + '/IBWebApi/WebLogin/UpLoadImage';
            // console.log(config);
            // return false;
            Upload.upload({
                //服务端接收
                url: url,
                file: file,
                headers: {
                    'Content-Language': $scope.Language
                }
            }).progress(function (evt) {
                //进度条
                var progressPercentage = parseInt(100.0 * evt.loaded / evt.total);
            }).success(function (callbackData) {
                // console.log(callbackData);
                $scope.loading = false;
                // $('#forms').valid();
                if (callbackData.Success) {
                    if (location.href.indexOf('CompanyRegister') > 0) {
                        // 为card赋值,注册时使用
                        $scope.registercomp[config.card] = callbackData.Data;
                    } else {
                        $scope.registerform[config.card] = callbackData.Data;
                    }
                    // // 为card赋值,注册时使用
                    // $scope.registerform[config.card] = callbackData.Data;
                    alert($scope.message[$scope.Language].success);
                    $(config.triggerCls).hide();
                    // $(config.shows).attr('src','http://192.168.3.200:8012/'+callbackData.Data)
                    // $scope.getimglist();
                } else {
                    alert(callbackData.Message);
                }
            }).error(function (data, status, headers, config) {
                console.log(error);
                alert($scope.message[$scope.Language].getError);
                $scope.loading = false;
            });
            // });
        }
    }
    //自定义字段
    $scope.forms = new Array();//动态字段表单
    $scope.formIds = fieldService.formIds;//表单Id
    fieldService.getFields([$scope.formIds.PersonalInformation, $scope.formIds.CompanyInformation], $scope.forms);//获取动态字段
}]);
//交易经验type类型
myApp.directive('onChecked', ['$timeout', function ($timeout, scope) {
    return {
        restrict: 'AE',
        scope: {
            dirData: '=',
            exData: '=',
            exLags: '='
        },
        link: function (scope, element, attrs) {
            $(element).on('change', function (event) {

                var $this = $(this);
                $timeout(function () {
                    var type = $this.prop('checked');
                    var values = $this.val();
                    if (type == true) {
                        scope.exData[values] = scope.exLags == 'en' ? 'Less than 1 year' : '小于1年';
                        scope.dirData.value = scope.exLags == 'en' ? 'Less than 1 year' : '小于1年';
                        scope.$apply();//更新
                    } else {
                        delete scope.exData[values];
                        scope.dirData.value = ''; scope.dirData.type = '';
                        scope.$apply();//更新
                    };
                    // },200)
                }, 200);
            })
        }
    };
}]);
//交易经验value值
myApp.directive('onValuechecked', ['$timeout', function ($timeout, scope) {
    return {
        restrict: 'AE',
        scope: {
            dirData: '=',
            exData: '='
        },
        link: function (scope, element, attrs) {
            $(element).unbind('click').bind('click', function (event) {
                event.stopPropagation();
                
                var type = $(this).prop('checked');
                var value = $(this).attr('data-config');
                var ex_value = $(this).val();

                if (type == true) {
                    scope.dirData.value = ex_value;
                    scope.dirData.type = true;
                    scope.exData[value] = ex_value;
                }
                scope.$apply();
            })
        }
    };
}]);
//入金记录
myApp.controller('paymentController', ['$scope', 'PagesService', function ($scope, PagesService) {
    $scope.payment = {
        'paydata': []
    };
    $scope.pageData = '';
    var page = { 'pageSize': 10, 'pageIndex': 1 };
    $scope.getPayment = function () {
        $scope.AccountStatus();
        var data = {
            'pageSize': page.pageSize,
            'pageIndex': page.pageIndex
        };
        $scope.matrixPost(true, "/WebTrade/GetPayRecord", data, function (res) {
            if (res.Success) {
                $scope.payment.paydata = res.Data.PageData;
                $scope.pageData = PagesService.pages(res.Data.TotalCount, data.pageSize, data.pageIndex);
            } else if (res.IsLogin == false) {
                $scope.clearSession();
            } else {
                alert($scope.message[$scope.Language].getError);
            }
        });
    }
    $scope.getPayment();
    //分页
    $scope.jumpPage = function (pageIndex, type) {
        // console.log(pageIndex)
        switch (type) {
            case 'pre':
                pageIndex--;
                // console.log();
                break;
            case 'next':
                pageIndex++;
                break;
            default:
                break;
        }
        page.pageIndex = pageIndex;
        // 获取数据
        $scope.getPayment();
    }
}]);
myApp.controller('refundController', ['$scope', 'PagesService', function ($scope, PagesService) {
    $scope.refundData = { 'data': [], 'pageSize': 10, 'pageIndex': 1 };
    $scope.pageData = '';
    $scope.getRefund = function () {
        $scope.AccountStatus();
        var data = {
            'pageIndex': $scope.refundData.pageIndex,
            'pageSize': $scope.refundData.pageSize
        };
        $scope.matrixPost(true, "/WebTrade/GetRefundRecord", data, function (res) {
            if (res.Success == true) {
                $scope.refundData.data = res.Data.PageData;
                $scope.pageData = PagesService.pages(res.Data.TotalCount, data.pageSize, data.pageIndex);
            } else if (res.IsLogin == false) {
                $scope.clearSession();
            } else {
                alert(res.Message);
            }
        });
    }

    $scope.getRefund();
    //分页
    $scope.jumpPage = function (pageIndex, type) {
        // console.log(pageIndex)
        switch (type) {
            case 'pre':
                pageIndex--;
                break;
            case 'next':
                pageIndex++;
                break;
            default:
                break;
        }
        $scope.refundData.pageIndex = pageIndex;
        // 获取数据
        $scope.getRefund();
    }
}]);
myApp.controller('DemoAccountController', ['$scope', '$http', '$location', function ($scope, $http, $location) {
    $scope.Demo = { 'Name': '', 'Address': '', 'Age': '', 'PhoneNumber': '', 'Email': '', 'Title': '', 'Content': '', 'TotalAssets': '', 'Language': '' };
    //模拟账户
    $('body').removeClass('bg-black');
    $scope.DemoAccount = function (valid) {
        if (!$('#fomrssd').valid()) {
            return false;
        }

        var data = $scope.Demo;
        $scope.matrixPost(true, "/WebLogin/VirtualAccountApply", data, function (res) {
            if (res.Success) {
                alert($scope.message[$scope.Language].demosuccess);
                $location.path("/index");
            } else {
                alert(res.Message);
            }
        })
    };
}])
//交易经验转换
myApp.directive('getExprice', [function (scope) {
    return {
        restrict: 'AE',
        link: function (scope, element, attrs) {
            var exprice = JSON.parse(scope.resInfo.TradingExperience);
            angular.forEach(exprice, function (value, key) {
                // console.log(key);
                switch (key) {
                    case '外汇':
                        scope.changes['foreign'].type = true;
                        scope.changes['foreign'].value = value;
                        break;
                    case 'Foreign Exchange':
                        scope.changes['foreign'].type = true;
                        scope.changes['foreign'].value = value;
                        break;
                    case '差价合约':
                        scope.changes['contract'].type = true;
                        scope.changes['contract'].value = value;
                        break;
                    case 'CFD':
                        scope.changes['contract'].type = true;
                        scope.changes['contract'].value = value;
                        break;
                    case '基金':
                        scope.changes['fund'].type = true;
                        scope.changes['fund'].value = value;
                        break;
                    case 'Fund':
                        scope.changes['fund'].type = true;
                        scope.changes['fund'].value = value;
                        break;
                    case '期货':
                        scope.changes['futures'].type = true;
                        scope.changes['futures'].value = value;
                        break;
                    case 'Futures':
                        scope.changes['futures'].type = true;
                        scope.changes['futures'].value = value;
                        break;
                    case '期权':
                        scope.changes['option'].type = true;
                        scope.changes['option'].value = value;
                        break;
                    case 'Option':
                        scope.changes['option'].type = true;
                        scope.changes['option'].value = value;
                        break;
                    case '股票':
                        scope.changes['gupiao'].type = true;
                        scope.changes['gupiao'].value = value;
                        break;
                    case 'Stock':
                        scope.changes['gupiao'].type = true;
                        scope.changes['gupiao'].value = value;
                        break;
                }
            })
            // scope.$apply();
        }
    }
}]);


myApp.controller('MemberUpgradeController', ['$scope', '$http', '$location', function ($scope, $http, $location) {

    var data = {
        'examId': '94388F5A-4D65-4D6E-84F5-509234A1F6E8',
        'clientLanguageCode': $scope.Language
    };
    $scope.QuestionList = [];
    $scope.getExamContent = function () {
        $scope.matrixPost(true, "/WebOnlineTest/GetExamContentById", data, function (res) {
            if (res.Success == true) {
                console.log(res);
                for (var i = 0; i < res.Data.length; i++) {
                    var questionEntity = res.Data[i].ContentJsonBean;
                    $scope.QuestionList.push(questionEntity);
                }
            } else if (res.IsLogin == false) {
                $scope.clearSession();
            } else {
                alert(res.Message);
            }
        });
    };
    $scope.getExamContent();

    $scope.ExamResultData = {};
    $scope.sure = function () {
        if (!$('#fomrexam').valid()) {
            return false;
        }

        var data = {
            'ResultContent': JSON.stringify($scope.ExamResultData),
            'ExamId': '94388F5A-4D65-4D6E-84F5-509234A1F6E8'
        };

        // debugger
        $scope.matrixPost(true, "/WebOnlineTest/SubmitExamResult", data, function (res) {
            if (res.Success) {

            } else if (res.IsLogin == false) {
                $scope.clearSession();
            } else {
                alert(res.Message);
            }
        })
    }

}])


function copyAddr()
{
	var tar = document.getElementById("usdtaddr");
	tar.select();
	document.execCommand("Copy"); 
	alert("复制成功！");
}

function switchwithdraw(v){
    if(v == 'usdt'){
        $('#usdtdraw').show();
        $('#usddraw').hide();
    }else{
        $('#usddraw').show();
        $('#usdtdraw').hide();
    }
}
